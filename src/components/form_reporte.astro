<section id="reporte-mantenimiento">
  <!-- <p>Complete el formulario para generar el reporte en PDF</p> -->

  <div class="form-container">
    <h2>Reporte de Mantenimiento</h2>
    <div class="form-group">
      <label for="cliente">Cliente:</label>
      <input type="text" id="cliente" placeholder="Nombre del cliente" />
    </div>

    <div class="form-group">
      <label for="marca">Marca Equipo #1:</label>
      <input type="text" id="marca" placeholder="Marca del equipo" />
    </div>

    <div class="form-group">
      <label for="tecnico">Técnico:</label>
      <input type="text" id="tecnico" placeholder="Nombre del técnico" />
    </div>

    <button onclick="generarReporte()" class="btn-generar"
      >Generar Reporte PDF</button
    >
  </div>

  <canvas id="reporteCanvas" width="1754" height="2481" style="display:none;"
  ></canvas>
</section>

<style>
  #reporte-mantenimiento {
  }

  #reporte-mantenimiento h2 {
    text-align: center;
    margin-bottom: 7px;
    border-bottom: solid 2px var(--clr-white);
  }

  .form-container {
    background: white;
    padding: 25px 25px;
    border-radius: 12px;
    border: solid 1px var(--clr-gray);
    width: 100%;
    max-width: 700px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 1px;
    font-weight: 600;
    color: var(--clr-dark);
    font-size: 14px;
  }

  .form-group input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border-radius: 6px;
    border: solid 1px var(--clr-white);
    background-color: var(--clr-white);
    box-sizing: border-box;
    transition: var(--transition);
  }

  .form-group input:focus {
    outline: none;
    border-color: var(--clr-gray);
  }

  .btn-generar {
    width: 100%;
    background-color: var(--clr-dark);
    color: var(--clr-white);
    border: none;
    border-radius: 8px;
    padding: 14px 24px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 10px;
  }

  .btn-generar:hover {
    /* background-color: #2361a5; */
    /* transform: scale(1.01); */
  }
</style>

<script>
  // @ts-nocheck

  // VALORES DE PRUEBA - Cambialos según necesites
  const VALORES_PRUEBA = {
    cliente: "JUAN PEREZ GOMEZ",
    marca: "LG",
    tecnico: "CARLOS RODRIGUEZ",
  };

  function generarReporte() {
    // Si los campos están vacíos, usa los valores de prueba
    const cliente =
      document.getElementById("cliente").value || VALORES_PRUEBA.cliente;
    const marca =
      document.getElementById("marca").value || VALORES_PRUEBA.marca;
    const tecnico =
      document.getElementById("tecnico").value || VALORES_PRUEBA.tecnico;

    const canvas = document.getElementById("reporteCanvas");
    const ctx = canvas.getContext("2d");

    // Cargar la plantilla
    const plantilla = new Image();
    plantilla.crossOrigin = "anonymous";
    plantilla.src = "/img/reporte/plantilla_reporte.jpg";

    plantilla.onload = function () {
      // Limpiar y dibujar la plantilla
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(plantilla, 0, 0, canvas.width, canvas.height);

      // Configuración del texto global
      ctx.fillStyle = "#000000";
      ctx.font = "24px Arial";
      ctx.textAlign = "left";

      // CLIENTE (arriba izquierda, después de "CLIENTE:")
      ctx.fillText(cliente.toUpperCase(), 232, 430);

      // MARCA EQUIPO #1 (debajo de "MARCA EQUIPO #1")
      ctx.fillText(marca.toUpperCase(), 310, 535);

      // TÉCNICO (abajo derecha en la sección "Técnico")
      ctx.fillText(tecnico.toUpperCase(), 1105, 2150);

      // Descargar el reporte
      const fecha = new Date();
      const link = document.createElement("a");
      const nombreArchivo = `Reporte_${cliente.replace(/\s+/g, "_")}_${fecha.getDate()}-${fecha.getMonth() + 1}-${fecha.getFullYear()}.jpg`;
      link.download = nombreArchivo;
      link.href = canvas.toDataURL("image/jpeg", 1.0);
      link.click();

      // alert("¡Reporte generado exitosamente!");
    };

    plantilla.onerror = function () {
      alert(
        "Error al cargar la plantilla. Verifica que la ruta sea correcta: /img/reporte/plantilla_reporte.jpg",
      );
    };
  }

  window.generarReporte = generarReporte;
</script>
